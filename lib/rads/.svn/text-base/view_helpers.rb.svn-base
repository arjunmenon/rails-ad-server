module Rads
  module ViewHelpers
    def show_banner(banner_type)
      banner_type = RadsBannerType.find_by_name(banner_type.to_s)
      if banner_type
        campaigns = RadsCampaign.find(:all, :include => "rads_banners", :conditions => ["rads_banners.rads_banner_type_id = ?", banner_type.id])
        total_budget = 0
        campaigns.each{ |campaign|
          total_budget += campaign.budget_remaining
        }
        campaign_fortune = {}
        i = 0
        campaigns.each{ |campaign|
          if campaign.budget_remaining > 0
            lower = i = i + 1 #increment by one to prevent overlap
            upper = i = ((campaign.budget_remaining.to_f/total_budget.to_f) * 100000) + i
            range = lower..upper
            campaign_fortune[range] = campaign
          end
        }
        random = rand(100000)
        campaign = nil
        campaign_fortune.each { |k,v|
          if k.include?(random)
            campaign = v
            break
          end
        }
        unless campaign.nil?
          banner = campaign.banner(banner_type.id)
          return banner.html if banner
        end
      end
      return  link_to image_tag("/images/rads/advertise_here.gif"), "/advertise"
    end
    
    def show_rads_panel(user_id)
      
    end
  end
end